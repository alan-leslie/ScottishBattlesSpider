<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
	<title>Mapstraction V2 core tests</title>
		
	<script type="text/javascript" src="mxn-harness.js"></script>
		
	<script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.8&appid=5wTxDW_V34GQjK.7glLG6OnJSRxCvfLj7ktMsuOoR42Gkm16vDVEjjw6FGWJ1Gky"></script> 
		
	<script type="text/javascript">
	//<![CDATA[
	var provider;
	(function() {
		var providerMatch = location.search.match( /provider=([^&]*)/ ),
			providerScript, mxnScript;
		if ( providerMatch ) {
			provider = providerMatch[1];
		} else {
			provider = 'googlev3';
		}
		switch ( provider ) {
			case 'google':
				document.write( '<script type="text/javascript" src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAY70wuSo0zF3ZtJVp5bDm1BS1Y2ErAqCHV5rDhHSzgjy23KqwdRRaoSBuZk72oDzzAYxVBjtsLqSmTw"><\/script>' );
				break;

			case 'openlayers':
				document.write( '<script type="text/javascript" src="http://dev.openlayers.org/releases/OpenLayers-2.9.1/OpenLayers.js"><\/script>' );
				break;

			case 'yahoo':
				// already loaded as the default swap target
				break;
				
			case 'microsoft':
				document.write('<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.3&mkt=en-us"><\/script>');
				break;
			case 'geocommons':
				document.write('<script type="text/javascript" src="http://geocommons.com/javascripts/f1.api.js"><\/script>');
				break;

			case 'leaflet':
				document.write('<script type="text/javascript" src="http://api.maps.yahoo.com/ajaxymap?v=3.8&appid=5wTxDW_V34GQjK.7glLG6OnJSRxCvfLj7ktMsuOoR42Gkm16vDVEjjw6FGWJ1Gky"><\/script>');
				document.write('<link href="http://leaflet.cloudmade.com/dist/leaflet.css" media="all" rel="stylesheet" type="text/css" \/>');
				document.write('<script src="http://leaflet.cloudmade.com/dist/leaflet.js" type="text/javascript"><\/script>');
				break;
			case 'googlev3':
			default:
				document.write( '<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"><\/script>' );
				break;
		}
		document.write( '<script type="text/javascript" src="../source/mxn.js?(' + provider + ',yahoo)"><\/script>' );
	})();
	//]]>
	</script>

	<script type="text/javascript">
	//<![CDATA[
	
	var m;
	window.onload = function() {
		var actionElm = document.getElementById('actions');
		var infoElm = document.getElementById('info');		
		var eventsElm = document.getElementById('events');
		
		m = new mxn.Mapstraction('map', provider);
		// So far this is only necessary for leaflet.
		m.setCenterAndZoom(new mxn.LatLonPoint(37.4419, -122.1419), 10);

		m.load.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Map has for provider: ' + oEvtSource.api + '<br/>';
		});

		m.endPan.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			var center = oEvtSource.getCenter();
			eventsElm.innerHTML += 'Map pan: ' + Dump(center) + '<br/>';
		});
		
		m.changeZoom.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			var zoom = oEvtSource.getZoom();
			eventsElm.innerHTML += 'Change zoom: ' + zoom.toString() + '<br/>';
		});
		
		m.markerAdded.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Marker added: ' + oEvtArgs.marker.labelText + '<br/>';
		});
		
		m.markerRemoved.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Marker removed: ' + oEvtArgs.marker.labelText + '<br/>';
		});

		m.polylineAdded.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Polyline added.<br/>';
		});

		m.polylineRemoved.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Polyline removed.<br/>';
		});
			m.click.addHandler(function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Map clicked: ' + Dump(oEvtArgs.location) + '<br/>';
		});
		
		var markerEventHandler = function(sEvtName, oEvtSource, oEvtArgs){
			eventsElm.innerHTML += 'Marker event: ' + sEvtName + ' - ' + oEvtSource.labelText + '<br/>';
		};
		
		var ops = [
			{ 
				desc: 'Center map', 
				action: function(){
					m.setCenterAndZoom(new mxn.LatLonPoint(37.4419, -122.1419), 10);
				} 
			},		 
			{
				desc: 'Pan map',
				action: function(){
					m.setCenter(new mxn.LatLonPoint(37.3419, -122.0419), {pan: true});
				}
			},
			{
				desc: 'Get info',
				action: function(){
					infoElm.innerHTML = 'Info<br/>';
					var bb = m.getBounds();
					infoElm.innerHTML += 'Bounds:<br/>' + Dump(bb) + '<br/>';
					var ll = m.getCenter();
					infoElm.innerHTML += 'Center: ' + Dump(ll) + '<br/>';
					infoElm.innerHTML += 'Map type: ' + m.getMapType() + '<br/>';
					infoElm.innerHTML += 'Zoom: ' + m.getZoom() + '<br/>';
				}
			},
			{
				desc: 'Set zoom',
				action: function(){
					m.setZoom(8);
				}
			},
			{
				desc: 'Change type',
				action: function(){
					m.setMapType(mxn.Mapstraction.SATELLITE);
				}
			},
			{
				desc: 'Add marker',
				action: function(){
					var mkr = new mxn.Marker(new mxn.LatLonPoint(37.3419, -122.0419));
					mkr.setLabel('Some random place');
					mkr.setInfoBubble('Some information about the random place');
					mkr.click.addHandler(markerEventHandler);
					mkr.openInfoBubble.addHandler(markerEventHandler);
					mkr.closeInfoBubble.addHandler(markerEventHandler);
					m.addMarker(mkr);
				}
			},
			{
				desc: 'Show info bubble',
				action: function(){
					m.markers[0].openBubble();
				}
			},
			{
				desc: 'Hide info bubble',
				action: function(){
					m.markers[0].closeBubble();
				}
			},
			{
				desc: 'Add marker offscreen',
				action: function(){
					var mkr = new mxn.Marker(new mxn.LatLonPoint(37.3419, -117.0419));
					mkr.setLabel('Some other place');
					m.addMarker(mkr);
				}
			},
			{
				desc: 'Auto center',
				action: function(){
					m.autoCenterAndZoom();
				}
			},
			{
				desc: 'Add line',
				action: function(){
					var pl = new mxn.Polyline([
						new mxn.LatLonPoint(37.3419, -122.0419),
						new mxn.LatLonPoint(36.3419, -120.0419),
						new mxn.LatLonPoint(38.3419, -119.0419),
						new mxn.LatLonPoint(37.3419, -117.0419)
					]);
					pl.color = '#00DD55';
					m.addPolyline(pl);
				}
			},
			{
				desc: 'Add controls',
				action: function() {
					m.addLargeControls();
					m.addControls({
						pan:	 true,
						zoom:	 'large',
						overview: true,
						scale: true,
						map_type: true
					});
				}
			},
			/*
			{
				desc: 'Add Base map type',
				action: function() {
					m.addTileLayer("http://tile.openstreetmap.org/{Z}/{X}/{Y}.png", 1.0, "OSM", 1, 19, true);
					// m.setMapType("OSM");
				}
			},
			*/			
			{
				desc: 'Swap API (yahoo)',
				action: function(){
					m.swap('map', 'yahoo');
				}
			},
			
			
			
			{ desc: 'Done.', action: function(){} }
		];
		
		RunTests(ops, actionElm, infoElm);
	};
		
	//]]>
	</script>
	<style type="text/css">
		.box {
			float: left; 
			width:300px; 
			margin-right: 20px;
			border: 1px solid #AAA;
		}
		
		.box h2 {
			margin: 0;
			padding: 5px;
			font-family: Arial;
			background-color: #DDD;
		}
		
		.box div {
			overflow-y: scroll;
			height:300px; 
		}

		#provider-selection {
			clear:both;
		}
	</style>
</head>
<body>
	<div style="height: 400px; width: 1000px; margin: 20px;">
		<div id="map" style="position: relative; width: 700px; height: 300px; float: left; margin: 0 20px 20px 0"></div>
		<div style="">
			<h3>Providers</h3>
			<ul id="providers" >
				<li><a href="core.html?provider=googlev3">Google</a></li>
				<li><a href="core.html?provider=leaflet">Leaflet</a></li>
				<li><a href="core.html?provider=microsoft">Microsoft</a></li>
				<li><a href="core.html?provider=openlayers">OpenLayers</a></li>
				<li><a href="core.html?provider=yahoo">Yahoo</a></li>
			</ul>
		</div>
		<div style="margin-top: 20px; clear: both;">
			
			<div class="box">
				<h2>Actions</h2>
				<div>
					<ol id="actions"></ol>
				</div>
			</div>
			<div class="box">
				<h2>Info</h2>
				<div id="info"></div>
			</div>
			<div class="box">
				<h2>Events</h2>
				<div id="events"></div>
			</div>
		
		</div>
		<p id="provider-selection">
			Run with provider: <a href="?provider=google">google</a>,
			<a href="?provider=googlev3">googlev3</a>,
			<a href="?provider=openlayers">openlayers</a>,
			<a href="?provider=yahoo">yahoo</a>
			<a href="?provider=microsoft">microsoft</a>
		</p>
		</div>
</body>
</html>

